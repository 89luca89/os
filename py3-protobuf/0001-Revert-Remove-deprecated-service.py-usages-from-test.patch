From 5864b5078a0187a1a16d4d2ed6f55972511d0a94 Mon Sep 17 00:00:00 2001
From: Jie Luo <jieluo@google.com>
Date: Wed, 27 Nov 2024 14:28:39 -0800
Subject: [PATCH] Revert "Remove deprecated service.py usages from test". For
 29.x only (#19434)

This reverts commit 471ff7727031d7ca17c62f34c38314758142393e.
---
 python/google/protobuf/internal/generator_test.py        | 7 +++++++
 .../google/protobuf/internal/service_reflection_test.py  | 9 ++++-----
 python/google/protobuf/service.py                        | 8 ++++----
 3 files changed, 15 insertions(+), 9 deletions(-)

diff --git a/python/google/protobuf/internal/generator_test.py b/python/google/protobuf/internal/generator_test.py
index 0f4ad6462..d11cb8d03 100644
--- a/python/google/protobuf/internal/generator_test.py
+++ b/python/google/protobuf/internal/generator_test.py
@@ -19,6 +19,7 @@ __author__ = 'robinson@google.com (Will Robinson)'
 import unittest
 
 from google.protobuf.internal import test_bad_identifiers_pb2
+from google.protobuf import service
 from google.protobuf import symbol_database
 from google.protobuf import unittest_import_pb2
 from google.protobuf import unittest_import_public_pb2
@@ -282,6 +283,12 @@ class GeneratorTest(unittest.TestCase):
     self.assertTrue(hasattr(unittest_no_generic_services_pb2, "FOO"))
     self.assertTrue(hasattr(unittest_no_generic_services_pb2, "test_extension"))
 
+    # Make sure unittest_no_generic_services_pb2 has no services subclassing
+    # Proto2 Service class.
+    if hasattr(unittest_no_generic_services_pb2, "TestService"):
+      self.assertFalse(issubclass(unittest_no_generic_services_pb2.TestService,
+                                  service.Service))
+
   def testMessageTypesByName(self):
     file_type = unittest_pb2.DESCRIPTOR
     self.assertEqual(
diff --git a/python/google/protobuf/internal/service_reflection_test.py b/python/google/protobuf/internal/service_reflection_test.py
index ca9e70a38..1a809d5e3 100644
--- a/python/google/protobuf/internal/service_reflection_test.py
+++ b/python/google/protobuf/internal/service_reflection_test.py
@@ -13,21 +13,21 @@ __author__ = 'petar@google.com (Petar Petrov)'
 import unittest
 
 from google.protobuf import service_reflection
+from google.protobuf import service
 from google.protobuf import unittest_pb2
 
 
 class FooUnitTest(unittest.TestCase):
 
   def testService(self):
-
-    class MockRpcChannel:
+    class MockRpcChannel(service.RpcChannel):
       def CallMethod(self, method, controller, request, response, callback):
         self.method = method
         self.controller = controller
         self.request = request
         callback(response)
 
-    class MockRpcController:
+    class MockRpcController(service.RpcController):
       def SetFailed(self, msg):
         self.failure_message = msg
 
@@ -81,8 +81,7 @@ class FooUnitTest(unittest.TestCase):
     self.assertEqual(True, srvc.bar_called)
 
   def testServiceStub(self):
-
-    class MockRpcChannel:
+    class MockRpcChannel(service.RpcChannel):
       def CallMethod(self, method, controller, request,
                      response_class, callback):
         self.method = method
diff --git a/python/google/protobuf/service.py b/python/google/protobuf/service.py
index 8002c040f..38b821791 100644
--- a/python/google/protobuf/service.py
+++ b/python/google/protobuf/service.py
@@ -70,12 +70,12 @@ class Service(object):
     Postconditions:
 
     * "done" will be called when the method is complete.  This may be
-     before CallMethod() returns or it may be at some point in the future.
+      before CallMethod() returns or it may be at some point in the future.
     * If the RPC failed, the response value passed to "done" will be None.
-     Further details about the failure can be found by querying the
-     RpcController.
+      Further details about the failure can be found by querying the
+      RpcController.
     """
-   raise NotImplementedError
+    raise NotImplementedError
 
   def GetRequestClass(self, method_descriptor):
     """Returns the class of the request message for the specified method.
-- 
2.45.2

